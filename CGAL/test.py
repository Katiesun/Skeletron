import skeletron

from cairo import Context, ImageSurface, FORMAT_RGB24
from shapely.wkt import dumps as wkt_dumps, loads as wkt_loads
from shapely.geometry import asPolygon

coords = [
  [
    [29.355902, 71.448935],
    [28.786797, 71.213203],
    [20.000000, 50.000000],
    [28.786797, 28.786797],
    [50.000000, 20.000000],
    [200.000000, 20.000000],
    [221.213203, 28.786797],
    [271.213203, 78.786797],
    [280.000000, 100.000000],
    [280.000000, 250.000000],
    [271.213203, 271.213203],
    [250.000000, 280.000000],
    [50.000000, 280.000000],
    [28.236465, 270.648209],
    [20.041465, 248.423235],
    [29.355902, 71.448935]
  ],
  [
    [
      [88.988891, 80.000000],
      [81.620470, 220.000000],
      [220.000000, 220.000000],
      [220.000000, 112.426407],
      [187.573593, 80.000000],
      [88.988891, 80.000000]
    ]
  ]
]

poly = asPolygon(*coords)
poly = wkt_loads('POLYGON ((-13634224.3124617021530867 4550298.5639015352353454, -13634219.5683181248605251 4550288.1094742352142930, -13634223.6060984656214714 4550277.3624617028981447, -13634234.0605257656425238 4550272.6183181237429380, -13634236.6798973549157381 4550273.6024471614509821, -13634237.5172741934657097 4550271.2377928793430328, -13634246.8672741930931807 4550258.5577928796410561, -13634256.6981047373265028 4550252.6284826928749681, -13634267.8422071188688278 4550255.3872741935774684, -13634273.7715173065662384 4550265.2181047378107905, -13634271.0127258058637381 4550276.3622071202844381, -13634268.5836506932973862 4550279.6563966833055019, -13634284.3899936098605394 4550289.7622112985700369, -13634291.0577603653073311 4550299.6607365598902106, -13634288.3892171420156956 4550311.2933971723541617, -13634278.0375564396381378 4550325.3532614707946777, -13634261.3296798337250948 4550350.6718168016523123, -13634251.8207638245075941 4550357.1047371942549944, -13634240.5481831990182400 4550354.9296798342838883, -13634234.1152628064155579 4550345.4207638241350651, -13634236.2903201673179865 4550334.1481831986457109, -13634246.2372792065143585 4550319.0748953884467483, -13634224.3124617021530867 4550298.5639015352353454))')
inner, outer, border = skeletron.xray(poly)

xmin, ymin, xmax, ymax = poly.bounds
scale = 480. / min(xmax - xmin, ymax - ymin)
print xmin, ymin, xmax, ymax, '-->', scale

img = ImageSurface(FORMAT_RGB24, 512, 512)
ctx = Context(img)

ctx.move_to(0, 0)
ctx.line_to(512, 0)
ctx.line_to(512, 512)
ctx.line_to(0, 512)
ctx.line_to(0, 0)

ctx.set_source_rgb(0xff, 0xff, 0xff)
ctx.fill()

ctx.translate(16, 16)
ctx.scale(scale, scale)
ctx.translate(-xmin, -ymin)
ctx.set_line_width(2/scale)

def draw_lines(lines, rgb):
    """
    """
    for line in lines:
        coords = iter(line.coords)
        ctx.move_to(*coords.next())
        
        for coord in coords:
            ctx.line_to(*coord)
    
        ctx.set_source_rgb(*rgb)
        ctx.stroke()

draw_lines(border, (.9, .9, .9))
draw_lines(outer, (.8, .8, .8))
draw_lines(inner, (0, 0, 0))

img.write_to_png('out.png')
